(this["webpackJsonpfactorial-app"]=this["webpackJsonpfactorial-app"]||[]).push([[0],{35:function(e,t,a){e.exports=a(57)},55:function(e,t,a){},56:function(e,t,a){},57:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(29),o=a.n(c),l=a(4),s=a(11),u=a(9),i=a(3),m=a.n(i),p=a(30),f=a(31),d=a(6),b=(a(48),a(49),a(50),{}),h=new(function(){function e(){Object(p.a)(this,e),d.initializeApp(b),this.auth=d.auth(),this.db=d.firestore(),this.storage=d.storage()}return Object(f.a)(e,[{key:"login",value:function(e,t){var a;return m.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m.a.awrap(d.auth().signInWithEmailAndPassword(e,t).catch((function(e){return console.log(e),e})));case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}))}},{key:"signin",value:function(e,t){var a;return m.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m.a.awrap(d.auth().createUserWithEmailAndPassword(e,t).catch((function(e){return console.log(e),e})));case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}))}},{key:"logout",value:function(){var e;return m.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.a.awrap(d.auth().signOut().catch((function(e){return console.log(e),e})));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"getUserState",value:function(){var e=this;return m.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.auth.onAuthStateChanged(t)})));case 1:case"end":return t.stop()}}))}},{key:"getPosts",value:function(){var e;return m.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[],t.next=3,m.a.awrap(d.firestore().collection("Posts").get());case 3:return t.sent.forEach((function(t){e.push({id:t.id,data:t.data()})})),t.abrupt("return",e);case 6:case"end":return t.stop()}}))}},{key:"getPost",value:function(e){var t,a;return m.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m.a.awrap(d.firestore().collection("Posts").doc(e).get());case 2:return t=n.sent,a=t.data(),n.abrupt("return",a);case 5:case"end":return n.stop()}}))}},{key:"createPost",value:function(e){var t,a,n,r,c,o,l;return m.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return t=d.storage().ref(),a=t.child(e.cover.name),s.next=4,m.a.awrap(a.put(e.cover));case 4:return n=s.sent,s.next=7,m.a.awrap(a.getDownloadURL());case 7:return r=s.sent,c=n.ref.location.path,o={tittle:e.tittle,content:e.content,cover:r,fileref:c},s.next=12,m.a.awrap(d.firestore().collection("Posts").add(o).catch((function(e){return console.log(e),e})));case 12:return l=s.sent,s.abrupt("return",l);case 14:case"end":return s.stop()}}))}},{key:"updatePost",value:function(e,t){var a,n,r,c,o,l,s,u;return m.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(!t.cover){i.next=19;break}return a=d.storage().ref(),n=a.child(t.cover.name),i.next=5,m.a.awrap(n.put(t.cover));case 5:return r=i.sent,i.next=8,m.a.awrap(n.getDownloadURL());case 8:return c=i.sent,o=r.ref.location.path,i.next=12,m.a.awrap(a.child(t.oldcover).delete().catch((function(e){console.log(e)})));case 12:return l={tittle:t.tittle,content:t.content,cover:c,fileref:o},i.next=15,m.a.awrap(d.firestore().collection("Posts").doc(e).set(l,{merge:!0}).catch((function(e){console.log(e)})));case 15:return s=i.sent,i.abrupt("return",s);case 19:return i.next=21,m.a.awrap(d.firestore().collection("Posts").doc(e).set(t,{merge:!0}).catch((function(e){console.log(e)})));case 21:return u=i.sent,i.abrupt("return",u);case 23:case"end":return i.stop()}}))}},{key:"deletePost",value:function(e,t){var a,n;return m.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return a=d.storage().ref(),r.next=3,m.a.awrap(a.child(t).delete().catch((function(e){console.log(e)})));case 3:return console.log("Image Deleted"),r.next=6,m.a.awrap(d.firestore().collection("Posts").doc(e).delete().catch((function(e){console.log(e)})));case 6:return n=r.sent,console.log("Post Deleted"),r.abrupt("return",n);case 9:case"end":return r.stop()}}))}}]),e}()),E=a(15),g=function(e,t){switch(t.type){case"SIGNIN":case"LOGIN":case"LOGOUT":return Object(E.a)({},e,{user:t.payload});default:return e}},v=r.a.createContext(),O={user:{}},w=Object(u.g)((function(e){var t=Object(n.useState)(null),a=Object(l.a)(t,2),c=a[0],o=a[1],u=Object(n.useState)(""),i=Object(l.a)(u,2),m=i[0],p=i[1],f=r.a.useContext(v),d=f.state,b=f.dispatch;Object(n.useEffect)((function(){h.getUserState().then((function(e){e&&(o(e),p(e.email))}))}));var E;return E=null!=c||d.user.hasOwnProperty("user")?r.a.createElement(r.a.Fragment,null,r.a.createElement("li",null,m),r.a.createElement("li",null,r.a.createElement("button",{className:"logout",onClick:function(){return h.logout(),o(null),e.history.replace("/login"),b({type:"LOGOUT",payload:{}})}},"LogOut"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("li",null,r.a.createElement(s.b,{to:"/signin"},"SignIn")),r.a.createElement("li",null,r.a.createElement(s.b,{to:"/login"},"LogIn"))),r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(s.b,{to:"/"},"Factorial"))),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(s.b,{to:"/create"},"New Post")),E))})),y=(a(55),function(e,t){switch(t.type){case"FETCH_POSTS":return Object(E.a)({},e,{posts:t.payload});default:return e}}),j=r.a.createContext(),x={posts:[]},P=Object(u.g)((function(){var e=r.a.useContext(j),t=e.state,a=e.dispatch;return Object(n.useEffect)((function(){!function(){var e;m.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.a.awrap(h.getPosts().catch((function(e){return console.log(e),e})));case 2:return e=t.sent,t.abrupt("return",a({type:"FETCH_POSTS",payload:e}));case 4:case"end":return t.stop()}}))}()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("header",null,r.a.createElement("div",null,r.a.createElement("h1",null,"React ",r.a.createElement("br",null)," Post Upload ",r.a.createElement("br",null)," App"))),r.a.createElement("div",{className:"posts"},t.posts.map((function(e){return r.a.createElement("div",{className:"post",key:e.id},r.a.createElement(s.b,{to:"post/"+e.id},r.a.createElement("div",{style:{backgroundImage:"url("+e.data.cover+")"}})))}))))})),S=function(){var e=Object(n.useState)(""),t=Object(l.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(""),s=Object(l.a)(o,2),i=s[0],p=s[1],f=Object(n.useState)(!1),d=Object(l.a)(f,2),b=d[0],E=d[1],g=r.a.useContext(v),O=g.state,w=g.dispatch;return b?r.a.createElement(u.a,{to:"/"}):r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{onSubmit:function(e){var t;return m.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(O),e.preventDefault(),n.next=4,m.a.awrap(h.signin(a,i));case 4:if(!(t=n.sent).hasOwnProperty("message")){n.next=9;break}console.log(t.message),n.next=11;break;case 9:return E(!0),n.abrupt("return",w({type:"SIGNIN",payload:t}));case 11:case"end":return n.stop()}}))}},r.a.createElement("p",null,"Create Account"),r.a.createElement("label",{htmlFor:"email"},"Email:"),r.a.createElement("input",{type:"email",name:"email",onChange:function(e){return c(e.target.value)}}),r.a.createElement("label",{htmlFor:"password"},"Password:"),r.a.createElement("input",{type:"password",name:"password",onChange:function(e){return p(e.target.value)}}),r.a.createElement("input",{type:"submit",value:"Create account"})))},C=function(){var e=Object(n.useState)(""),t=Object(l.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(""),s=Object(l.a)(o,2),i=s[0],p=s[1],f=Object(n.useState)(!1),d=Object(l.a)(f,2),b=d[0],E=d[1],g=r.a.useContext(v),O=(g.state,g.dispatch);return b?r.a.createElement(u.a,{to:"/"}):r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{onSubmit:function(e){var t;return m.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e.preventDefault(),n.next=3,m.a.awrap(h.login(a,i));case 3:if(!(t=n.sent).hasOwnProperty("message")){n.next=8;break}console.log(t.message),n.next=10;break;case 8:return E(!0),n.abrupt("return",O({type:"LOGIN",payload:t.user}));case 10:case"end":return n.stop()}}))}},r.a.createElement("p",null,"Welcome Back"),r.a.createElement("label",{htmlFor:"email"},"Email:"),r.a.createElement("input",{type:"email",name:"email",onChange:function(e){return c(e.target.value)}}),r.a.createElement("label",{htmlFor:"password"},"Password:"),r.a.createElement("input",{type:"password",name:"password",onChange:function(e){return p(e.target.value)}}),r.a.createElement("input",{type:"submit",value:"Login"})))},k=Object(u.g)((function(e){var t,a=Object(n.useState)(""),c=Object(l.a)(a,2),o=c[0],s=c[1],i=Object(n.useState)(""),p=Object(l.a)(i,2),f=p[0],d=p[1],b=Object(n.useState)(""),E=Object(l.a)(b,2),g=E[0],v=E[1],O=Object(n.useState)(!1),w=Object(l.a)(O,2),y=w[0],j=w[1],x=Object(n.useState)(!1),P=Object(l.a)(x,2),S=P[0],C=P[1];return Object(n.useEffect)((function(){h.getUserState().then((function(t){t||e.history.replace("/login")}))})),S?r.a.createElement(u.a,{to:"/"}):(t=y?r.a.createElement("div",{className:"processing"},r.a.createElement("p",null,"Request is being processed"),r.a.createElement("div",{className:"loader"},"Loading...")):r.a.createElement("form",{onSubmit:function(e){var t;return m.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return e.preventDefault(),j(!0),t={tittle:o,content:f,cover:g[0]},a.next=5,m.a.awrap(h.createPost(t).then((function(){console.log("post created succesfully"),j(!1),C(!0)})).catch((function(e){console.log(e),j(!1)})));case 5:case"end":return a.stop()}}))}},r.a.createElement("p",null,"Create a new post"),r.a.createElement("label",{htmlFor:"tittle"},"Post Tittle:"),r.a.createElement("input",{type:"text",name:"tittle",onChange:function(e){return s(e.target.value)}}),r.a.createElement("label",{htmlFor:"content"},"Post Content:"),r.a.createElement("textarea",{name:"content",onChange:function(e){return d(e.target.value)}}),r.a.createElement("label",{htmlFor:"cover"},"Cover:"),r.a.createElement("input",{type:"file",onChange:function(e){return v(e.target.files)}}),r.a.createElement("input",{type:"submit",value:"create post"})),r.a.createElement(r.a.Fragment,null,t))})),F=function(e){var t,a,c,o=Object(n.useState)(!1),s=Object(l.a)(o,2),i=s[0],p=s[1],f=Object(n.useState)(!1),d=Object(l.a)(f,2),b=d[0],E=d[1],g=Object(n.useState)(!1),v=Object(l.a)(g,2),O=v[0],w=v[1],y=Object(n.useState)(!1),j=Object(l.a)(y,2),x=j[0],P=j[1],S=Object(n.useState)(""),C=Object(l.a)(S,2),k=C[0],F=C[1],N=Object(n.useRef)(null),I=Object(n.useRef)(null),L=Object(n.useRef)(null),U=Object(n.useState)(""),R=Object(l.a)(U,2),D=R[0],T=R[1],A=Object(n.useState)(!1),G=Object(l.a)(A,2),W=G[0],q=G[1];if(Object(n.useEffect)((function(){p(!0),T(e.match.params.id),function(e){var t;m.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,m.a.awrap(h.getPost(e).catch((function(e){return console.log(e),e})));case 2:t=a.sent,F(t);case 4:case"end":return a.stop()}}))}(e.match.params.id),h.getUserState().then((function(e){e&&w(e)})),setTimeout((function(){return p(!1)}),1e3)}),[e.match.params.id]),W)return r.a.createElement(u.a,{to:"/"});var B;return b&&(c=r.a.createElement("button",{className:"delete",onClick:function(e){h.deletePost(D,k.fileref).then((function(){q(!0)})).catch((function(e){console.log(e)}))}},"Delete Post"),B=x?r.a.createElement("div",{className:"processing"},r.a.createElement("p",null,"Request is being processed"),r.a.createElement("div",{className:"loader"},"Loading...")):r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{className:"editForm",onSubmit:function(e){e.preventDefault(),P(!0);var t={tittle:N.current.value,content:I.current.value};L.current.files.length>0&&(t.cover=L.current.files[0],t.oldcover=k.fileref),h.updatePost(D,t).then((function(){console.log("Post Updated"),P(!1),q(!0)})).catch((function(e){console.log(e)}))}},r.a.createElement("p",null,"Update the current post"),r.a.createElement("label",{htmlFor:"tittle"},"Post Tittle:"),r.a.createElement("input",{type:"text",name:"tittle",ref:N,defaultValue:k.tittle}),r.a.createElement("label",{htmlFor:"content"},"Post Content:"),r.a.createElement("textarea",{name:"content",ref:I,defaultValue:k.content}),r.a.createElement("label",{htmlFor:"cover"},"Cover:"),r.a.createElement("input",{type:"file",ref:L}),r.a.createElement("input",{type:"submit",value:"update post"})),c)),i?t=r.a.createElement("div",{className:"processing"},r.a.createElement("p",null,"Request is being processed"),r.a.createElement("div",{className:"loader"},"Loading...")):(O&&(a=r.a.createElement("button",{className:"edit",onClick:function(e){E(!b)}},"Edit Post")),t=r.a.createElement("div",{className:"single"},r.a.createElement("img",{src:k.cover,alt:"post cover"}),r.a.createElement("h2",null,k.tittle),r.a.createElement("div",null,k.content),a,B)),r.a.createElement(r.a.Fragment,null,t)},N=function(){return r.a.createElement(u.d,null,r.a.createElement(u.b,{exact:!0,path:"/",component:P}),r.a.createElement(u.b,{exact:!0,path:"/signin",component:S}),r.a.createElement(u.b,{exact:!0,path:"/login",component:C}),r.a.createElement(u.b,{exact:!0,path:"/create",component:k}),r.a.createElement(u.b,{exact:!0,path:"/post/:id",component:F}))},I=(a(56),function(){return r.a.createElement("div",{className:"App"},r.a.createElement(w,null),r.a.createElement("main",null,r.a.createElement(N,null)))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(s.a,null,r.a.createElement((function(e){var t=r.a.useReducer(g,O),a=Object(l.a)(t,2),n={state:a[0],dispatch:a[1]};return r.a.createElement(v.Provider,{value:n},e.children)}),null,r.a.createElement((function(e){var t=r.a.useReducer(y,x),a=Object(l.a)(t,2),n={state:a[0],dispatch:a[1]};return r.a.createElement(j.Provider,{value:n},e.children)}),null,r.a.createElement(I,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[35,1,2]]]);
//# sourceMappingURL=main.2b82cdf7.chunk.js.map